tosca_definitions_version: tosca_simple_yaml_1_2

imports:
- https://raw.githubusercontent.com/micado-scale/tosca/develop/micado_types.yaml

node_types:
  micado.deployment.{{ id }}:
    derived_from: micado.deployment

topology_template:

  substitution_mappings:
    node_type: micado.deployment.{{ id }}

  node_templates:
    deployment.{{ id }}:
    {% if type == 'cloudbroker' %}
      type: tosca.nodes.MiCADO.CloudBroker.Compute
      properties:
        deployment_id: {{ cloudbroker['deployment_id'] }}
        instance_type_id: {{ cloudbroker['instance_type_id'] }}
        key_pair_id: {{ cloudbroker['key_pair_id'] }}
        opened_port: "{{ cloudbroker['opened_port'] }}"

      interfaces:
         Occopus:
           create:
             inputs:
               endpoint: {{ cloudbroker['endpoint'] }}
    {% elif type == 'edge' %}
      {{ raise("No implementation for edge deployment") }}
    {% else %}
      {{ raise("Wrong type of deployment") }}
    {% endif %}
