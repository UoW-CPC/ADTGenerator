tosca_definitions_version: tosca_simple_yaml_1_2

metadata:
  id: "{{ id }}"
  name: "{{ name }}"
  author: "{{ author }}"
  date: "{{ date }}"
  version: "{{ version }}"
  classificationSchema: "{{ classificationSchema }}"
  type:
  {%- for _type in type %}
  - "{{ _type }}"
  {%- endfor %}

description: "{{ description }}"

imports:
- https://raw.githubusercontent.com/micado-scale/tosca/digitbrain/micado_types.yaml
{%- for microservice in abstractHostDefinition %}
- {{ microservice }}.yaml
{%- endfor %}
{%- for host in abstractHostDefinition.values() | unique %}
- {{ host }}.yaml
{%- endfor %}

repositories:
  docker_hub: https://hub.docker.com/
  dbs_registry: https://dbs-container-repo.emgora.eu/v2/

topology_template:
  node_templates:
  {%- for microservice in listOfMicroservices %}
    {{microservice}}:
      type: dbs.{{ microservice }}
      requirements:
      {%- for _microservice in abstractHostDefinition.items() %}
      {%- set _microservice, host = _microservice %}
      {%- if _microservice == microservice %}
      - {{host}}
      {%- endif %}
      {%- endfor %}
  {%- endfor %}
  {%- for host in abstractHostDefinition.values() | unique %}
    {{ host }}:
      type: dbs.{{ host }}
  {%- endfor %}
