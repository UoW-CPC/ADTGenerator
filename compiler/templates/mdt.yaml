tosca_definitions_version: tosca_simple_yaml_1_2

metadata:
  id: "{{ id }}"
  name: "{{ name }}"
  author: "{{ author }}"
  date: "{{ date }}"
  version: "{{ version }}"
  classificationSchema: "{{ classificationSchema }}"
  {%- if type != NULL %}
  type:
  {%- endif %}
  {%- for _type in type %}
  - "{{ _type }}"
  {%- endfor %}

description: "{{ description }}"

imports:
- https://raw.githubusercontent.com/micado-scale/tosca/digitbrain/micado_types.yaml

repositories:
  docker_hub: https://hub.docker.com/
  dbs_registry: https://dbs-container-repo.emgora.eu/v2/

node_types:
  dbs.microservice.{{ id }}:
    derived_from: dbs.microservice
    properties:
      {%- for param in parameters %}
      {{ param['name'] }}:
        type: "{{ param['type'] }}"
        description: "{{ param['description'] }}"
        {%- if param[ 'defaultValue' ] != NULL %}
        default: "{{ param['defaultValue'] }}"
        {%- endif %}
        {%- if param[ 'mandatory' ] != NULL %}
        required: {{ param['mandatory'] }}
        {%- endif %}
      {%- endfor %}

topology_template:
  inputs:
    {%- for param in parameters %}
    {{ param[ 'name' ]}}:
      type: "{{ param['type'] }}"
      description: "{{ param['description'] }}"
      {%- if param[ 'defaultValue' ] != NULL %}
      default: "{{ param['defaultValue'] }}"
      {%- endif %}
      {%- if param[ 'mandatory' ] != NULL %}
      required: {{ param['mandatory'] }}
      {%- endif %}
    {%- endfor %}

  substitution_mappings:
    node_type: "dbs.microservice.{{ id }}"

{{ translate(deploymentData) }}

