tosca_definitions_version: tosca_simple_yaml_1_2

metadata:
  id: "{{ description['id'] }}"
  name: "{{ description['name'] }}"
  author: "{{ description['author'] }}"
  date: "{{ description['date'] }}"
  version: "{{ description['version'] }}"
  classificationSchema: "{{ description['classificationSchema'] }}"
  type:
  {%- for type in description["type"] %}
  - "{{ type }}"
  {%- endfor %}

description: "{{ description['description'] }}"

imports:
  - https://raw.githubusercontent.com/micado-scale/tosca/digitbrain/micado_types.yaml

repositories:
  docker_hub: https://hub.docker.com/
  dbs_registry: https://dbs-container-repo.emgora.eu/v2/

node_types:
  dbs.microservice.{{ description.name }}.{{ description.id }}:
    derived_from: dbs.microservice
    properties:
      {%- for param in parameters["parameters"] %}
      "{{ param['name'] }}":
        type: "{{ param['type'] }}"
        description: "{{ param['description'] }}"
        {%- if param['defaultValue'] != NULL %}
        default: "{{ param['defaultValue'] }}"
        {%- endif %}
        {%- if param['mandatory'] != NULL %}
        required: "{{ param['mandatory'] }}"
        {%- endif %}
      {%- endfor %}

topology_template:
  inputs:
    {%- for param in parameters["parameters"] %}
    "{{ param['name'] }}":
      type: "{{ param['type'] }}"
      description: "{{ param['description'] }}"
      {%- if param['defaultValue'] != NULL %}
      default: "{{ param['defaultValue'] }}"
      {%- endif %}
      {%- if param['mandatory'] != NULL %}
      required: "{{ param['mandatory'] }}"
      {%- endif %}
    {%- endfor %}

  substitution_mappings:
    node_type: "dbs.microservice.{{ description['name'] }}.{{ description['id'] }}"
        
  node_templates:
    {{ dockerkubernetesadt.transform(service.deploymentData) }}
